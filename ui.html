<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Design VC Plugin</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #login, #projects, #main { margin-bottom: 20px; }
    input, textarea, button { width: 100%; box-sizing: border-box; margin-top: 6px; }
    #projectList { list-style: none; padding: 0; }
    li { cursor: pointer; padding: 4px; border-bottom: 1px solid #ddd; }
    li:hover { background: #f0f0f0; }
  </style>
</head>
<body>

  <!-- LOGIN UI -->
  <div id="login">
    <h3>Login</h3>
    <input id="emailInput" type="email" placeholder="Email" />
    <input id="passwordInput" type="password" placeholder="Password" />
    <button id="btnLogin">Log In</button>
    <p id="loginError" style="color:red"></p>
  </div>

  <!-- PROJECT SELECTION UI -->
  <div id="projects" style="display:none">
    <h3>Your Projects</h3>
    <ul id="projectList"></ul>
    <h4>Create New Project</h4>
    <input id="newName" placeholder="Project Name" />
    <textarea id="newDesc" rows="2" placeholder="Description (optional)"></textarea>
    <button id="btnCreate">Create Project</button>
    <p id="projError" style="color:red"></p>
  </div>

  <!-- MAIN (after project selected) -->
  <div id="main" style="display:none">
    <h3 id="selProjectName"></h3>
    <!-- Commit UI goes here -->
  </div>

  <script>
const BACKEND = 'https://design-vc-backend.vercel.app/api';
let jwt = null;
let selectedProject = null;

// DOM elements
const loginDiv = document.getElementById('login');
const projectsDiv = document.getElementById('projects');
const mainDiv = document.getElementById('main');

const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const btnLogin = document.getElementById('btnLogin');
const loginError = document.getElementById('loginError');

const newNameInput = document.getElementById('newName');
const newDescInput = document.getElementById('newDesc');
const btnCreate = document.getElementById('btnCreate');
const projError = document.getElementById('projError');
const projectList = document.getElementById('projectList');
const selProjectName = document.getElementById('selProjectName');

// Show/hide UI panels
function showLogin() { loginDiv.style.display = 'block'; projectsDiv.style.display = 'none'; mainDiv.style.display = 'none'; }
function showProjects() { loginDiv.style.display = 'none'; projectsDiv.style.display = 'block'; mainDiv.style.display = 'none'; }
function showMain() { loginDiv.style.display = 'none'; projectsDiv.style.display = 'none'; mainDiv.style.display = 'block'; }

// Auto-login if JWT exists
// (async () => {
//   jwt = localStorage.getItem('jwt');
//   if (jwt) {
//     showProjects();
//     loadProjects();
//   }
// })();

// LOGIN
btnLogin.onclick = async () => {
  loginError.textContent = '';
  const emailVal = emailInput.value.trim();
  const pwVal = passwordInput.value;

  if (!emailVal || !pwVal) {
    loginError.textContent = 'Enter email + password';
    return;
  }

  try {
    const res = await fetch(`${BACKEND}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: emailVal, password: pwVal })
    });

    const json = await res.json();
    if (!res.ok) throw new Error(json.error || 'Login failed');

    jwt = json.token;
    // localStorage.setItem('jwt', jwt);
    showProjects();
    loadProjects();
  } catch (err) {
    loginError.textContent = err.message;
  }
};

// LOAD PROJECTS
async function loadProjects() {
  projError.textContent = '';
  projectList.innerHTML = '';

  try {
    const res = await fetch(`${BACKEND}/projects`, {
      headers: { 'Authorization': 'Bearer ' + jwt }
    });

    if (!res.ok) throw new Error('Fetch failed');

    const { own, shared } = await res.json();
    const all = own.concat(shared);

    all.forEach(p => {
      const li = document.createElement('li');
      li.textContent = p.name;
      li.onclick = () => {
        selectedProject = p;
        selProjectName.innerText = p.name;
        showMain();
        // You can add commit UI or send message to code.ts here
      };
      projectList.appendChild(li);
    });
  } catch (err) {
    projError.textContent = err.message;
  }
}

// CREATE PROJECT
btnCreate.onclick = async () => {
  projError.textContent = '';
  const nameVal = newNameInput.value.trim();
  const descVal = newDescInput.value.trim();

  if (!nameVal) {
    projError.textContent = 'Project name required';
    return;
  }

  try {
    const res = await fetch(`${BACKEND}/projects`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + jwt
      },
      body: JSON.stringify({ name: nameVal, description: descVal })
    });

    const json = await res.json();
    if (!res.ok) throw new Error(json.error || 'Create failed');

    newNameInput.value = '';
    newDescInput.value = '';
    loadProjects();
  } catch (err) {
    projError.textContent = err.message;
  }
};
</script>


</body>
</html>
